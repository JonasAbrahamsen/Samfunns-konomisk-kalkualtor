<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Samfunnsøkonomisk Kalkulator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', sans-serif;
            background-color: #F9FCF3;
            color: #1a1a1a;
            line-height: 1.6;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        header {
            margin-bottom: 40px;
            text-align: center;
        }

        h1 {
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #1a1a1a;
        }

        .subtitle {
            font-size: 16px;
            color: #666;
            font-weight: 400;
        }

        .input-section {
            background: white;
            padding: 32px;
            border-radius: 16px;
            margin-bottom: 40px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
        }

        .input-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 24px;
        }

        .input-row.full {
            grid-template-columns: 1fr;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #1a1a1a;
            text-transform: none;
            letter-spacing: 0.5px;
            white-space: nowrap;
        }

        input[type="text"],
        input[type="number"],
        select {
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            transition: border-color 0.2s;
        }

        input[type="text"]:focus,
        input[type="number"]:focus,
        select:focus {
            outline: none;
            border-color: #4a7c59;
        }

        .radio-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .radio-option {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .radio-option:hover {
            border-color: #4a7c59;
            background-color: #f5f9f0;
        }

        .radio-option input[type="radio"] {
            margin-right: 12px;
            cursor: pointer;
            accent-color: #4a7c59;
        }

        .percentage-btn {
            flex: 1;
            min-width: 70px;
            padding: 10px 12px;
            border: 2px solid #e0e0e0;
            background-color: white;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            color: #1a1a1a;
            cursor: pointer;
            transition: all 0.2s;
        }

        .percentage-btn:hover {
            border-color: #4a7c59;
            background-color: #f5f9f0;
        }

        .percentage-btn.active {
            border-color: #4a7c59;
            background-color: #4a7c59;
            color: white;
        }

        .button-group {
            display: flex;
            gap: 12px;
            margin-top: 32px;
        }

        button {
            flex: 1;
            padding: 14px 24px;
            font-size: 16px;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-calculate {
            background-color: #4a7c59;
            color: white;
        }

        .btn-calculate:hover {
            background-color: #3a6449;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(74, 124, 89, 0.2);
        }

        .btn-reset {
            background-color: #f0f0f0;
            color: #1a1a1a;
        }

        .btn-reset:hover {
            background-color: #e0e0e0;
        }

        .results-section {
            display: none;
            animation: slideIn 0.3s ease-out;
        }

        .results-section.active {
            display: block;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .results-container {
            background: white;
            padding: 32px;
            border-radius: 16px;
            margin-bottom: 24px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
        }

        .results-container h2 {
            font-size: 16px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 20px;
            color: #1a1a1a;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .result-item:last-child {
            border-bottom: none;
        }

        .result-label {
            font-size: 14px;
            color: #666;
        }

        .result-value {
            font-size: 16px;
            font-weight: 600;
            color: #1a1a1a;
        }

        .total-savings {
            background: white;
            border: 3px solid #4a7c59;
            padding: 32px;
            border-radius: 16px;
            text-align: center;
        }

        .total-savings h3 {
            font-size: 14px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 16px;
            color: #1a1a1a;
        }

        .total-amount {
            font-size: 48px;
            font-weight: 700;
            color: #4a7c59;
            margin-bottom: 8px;
        }

        .total-description {
            font-size: 13px;
            color: #666;
            line-height: 1.5;
        }

        .info-box {
            background: transparent;
            border-left: none;
            padding: 0;
            border-radius: 0;
            margin-bottom: 0;
        }

        .info-box p {
            font-size: 15px;
            color: #1a1a1a;
            line-height: 1.6;
            margin: 0;
        }

        .disclaimer-box {
            background: white;
            border: 2px solid #e0e0e0;
            padding: 24px;
            border-radius: 8px;
            margin-top: 32px;
            font-size: 13px;
            color: #666;
            line-height: 1.7;
        }

        .disclaimer-box a {
            color: #4a7c59;
            text-decoration: none;
            font-weight: 600;
        }

        .disclaimer-box a:hover {
            text-decoration: underline;
        }

        .municipality-note {
            margin-top: 20px;
            padding: 16px;
            background-color: #f5f9f0;
            border-radius: 8px;
            font-size: 13px;
            color: #666;
        }

        .municipality-note strong {
            color: #1a1a1a;
        }

        @media (max-width: 600px) {
            .input-row {
                grid-template-columns: 1fr;
            }

            h1 {
                font-size: 24px;
            }

            .total-amount {
                font-size: 36px;
            }

            .container {
                padding: 24px 16px;
            }

            .input-section,
            .results-container,
            .total-savings {
                padding: 24px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Samfunnsøkonomiske kostnader av fysisk inaktivitet</h1>
            <p class="subtitle">Fysisk aktivitet og helsetjenestekostnader</p>
            <p style="font-size: 10px; color: #666; margin-top: 12px; line-height: 1.6;">
                Kalkulatoren kan brukes av kommuner, regioner, statlige myndigheter og andre aktører som vurderer å iverksette tiltak som kan øke befolkningens aktivitetsnivå.
            </p>
        </header>

        <div class="input-section">
            <h2 style="font-size: 18px; font-weight: 600; margin-bottom: 8px; color: #1a1a1a;">Gjør en beregning</h2>
            <h3 style="font-size: 14px; font-weight: 400; color: #666; margin-bottom: 24px;">Velg kommune og aktivitetsnivå i cellene nedfor</h3>

            <div class="input-row">
                <div class="form-group">
                    <label for="municipality">Kommune</label>
                    <input 
                        type="text" 
                        id="municipality" 
                        placeholder="Søk kommune..." 
                        autocomplete="off"
                    >
                    <div id="municipalitySuggestions" style="display: none; position: absolute; background: white; border: 1px solid #e0e0e0; border-radius: 8px; margin-top: 4px; width: calc(50% - 30px); max-height: 200px; overflow-y: auto; z-index: 1000;"></div>
                </div>

                <div class="form-group">
                    <label for="childCount">Antall barnehagebarn (fra år 1)</label>
                    <input 
                        type="number" 
                        id="childCount" 
                        placeholder="0" 
                        min="0"
                    >
                </div>
            </div>

            <div class="input-row full">
                <div class="form-group">
                    <label>Andel barn som forventes å oppnå aktivitetsendring (%)</label>
                    <div style="display: flex; gap: 8px; flex-wrap: nowrap; margin-top: 12px;">
                        <button type="button" class="percentage-btn" data-value="10">10%</button>
                        <button type="button" class="percentage-btn" data-value="20">20%</button>
                        <button type="button" class="percentage-btn active" data-value="30">30%</button>
                        <button type="button" class="percentage-btn" data-value="40">40%</button>
                        <button type="button" class="percentage-btn" data-value="50">50%</button>
                    </div>
                    <input type="hidden" id="percentageValue" value="30">
                </div>
            </div>

            <div class="input-row full">
                <div class="form-group">
                    <label>Aktivitetsnivå</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input 
                                type="radio" 
                                id="activity1" 
                                name="activity" 
                                value="delvis-fysisk"
                                checked
                            >
                            <label for="activity1">Delvis aktiv → Fysisk aktiv</label>
                        </div>
                        <div class="radio-option">
                            <input 
                                type="radio" 
                                id="activity2" 
                                name="activity" 
                                value="fysisk-ekstra"
                            >
                            <label for="activity2">Fysisk aktiv → Ekstra aktiv</label>
                        </div>
                    </div>
                </div>
            </div>

            <div class="button-group">
                <button class="btn-calculate" onclick="calculateResults()">Beregn</button>
                <button class="btn-reset" onclick="resetForm()">Nullstill</button>
            </div>
        </div>

        <div class="results-section" id="resultsSection">
            <div class="results-container">
                <h2>Resultat</h2>
                
                <p id="infoText" style="font-size: 15px; color: #1a1a1a; margin-bottom: 20px; line-height: 1.6;"></p>
                
                <div style="margin-bottom: 24px;">
                    <h3 style="font-size: 14px; font-weight: 600; color: #1a1a1a; margin-bottom: 12px;">Helsekostnad-besparelse:</h3>
                    <div class="result-item">
                        <span class="result-label">Årlig helsekostnad-besparelse</span>
                        <span class="result-value" id="healthSavings">0 kr</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Parkdressen-kostnad</span>
                        <span class="result-value" id="parkdressenCost">0 kr</span>
                    </div>
                    <div class="result-item" style="border-bottom: none; padding: 12px 0;">
                        <span class="result-label" style="font-style: italic;">Mill. kr per år i potensiell reduksjon i helsetjenestekostnader (2023-kr)</span>
                        <span class="result-value" id="annualReduction" style="font-style: italic;">0 mill. kr</span>
                    </div>
                </div>
            </div>

            <div class="total-savings">
                <h3>Total besparelse</h3>
                <div class="total-amount" id="totalSavings">0 kr</div>
                <div class="total-description" id="totalDescription">
                    Årlig netto besparelse for barnehagebarna
                </div>
                <div class="municipality-note">
                    <strong id="municipalityName">-</strong> kommune har mulighet til å spare betydelige ressurser ved å øke fysisk aktivitet blant barnehagebarna.
                </div>
            </div>
        </div>

        <div class="disclaimer-box">
            <strong>Merk:</strong> Kalkulatoren sier ikke noe om effekten av tiltak, men kun omtaler potensielle gevinster gitt at det kan iverksettes effektive tiltak. Effekt av tiltak og tiltakskostnader må dokumenteres i spesifikke tiltaksanalyser, for eksempel av abonnement på parkdress. Viktige forbehold ved bruk er angitt over. Kalkulatoren er produsert av Helsedirektoratet. For mer informasjon <a href="https://www.helsedirektoratet.no/forebygging-diagnose-og-behandling/forebygging-og-levevaner/fysisk-aktivitet/kalkulator-helseeffekter-av-fysisk-aktivitet" target="_blank">klikk på lenken her</a>.
        </div>
    </div>

    <script>
        // CSV data source
        const CSV_FILE = 'barnehage_data.csv'; // CSV-filen som ligger i samme mappe
        
        let municipalities = {}; // Will be populated from CSV

        const PARKDRESSEN_COST_PER_CHILD = 1030;
        const HEALTH_SAVINGS_PER_CHILD = {
            'delvis-fysisk': 6776,
            'fysisk-ekstra': 4645
        };

        // Hent data fra CSV-fil ved siden last
        document.addEventListener('DOMContentLoaded', function() {
            fetchMunicipalitiesFromCSV();
        });

        function fetchMunicipalitiesFromCSV() {
            fetch(CSV_FILE)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Kunne ikke laste CSV-fil');
                    }
                    return response.text();
                })
                .then(csvText => {
                    // Parse CSV
                    const lines = csvText.trim().split('\n');
                    
                    if (lines.length > 1) {
                        // Skip header row (row 0)
                        for (let i = 1; i < lines.length; i++) {
                            const line = lines[i].trim();
                            if (line) {
                                // Split by comma, handling quoted fields
                                const parts = line.split(',');
                                if (parts.length >= 3) {
                                    const kommune = parts[1].trim().replace(/"/g, '');
                                    const antallBarn = parseInt(parts[2]) || 0;
                                    
                                    if (kommune && antallBarn > 0) {
                                        municipalities[kommune] = antallBarn;
                                    }
                                }
                            }
                        }
                    }
                    console.log('Kommune-data lastet fra CSV:', Object.keys(municipalities).length, 'kommuner');
                })
                .catch(error => {
                    console.error('Feil ved henting av kommune-data:', error);
                });
        }

        function formatCurrency(value) {
            return new Intl.NumberFormat('no-NO', {
                style: 'currency',
                currency: 'NOK',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(value);
        }

        function getMunicipalitySuggestions(input) {
            if (input.length === 0) return [];
            const lowerInput = input.toLowerCase();
            // Hent forslag fra dynamisk lastet kommune-data
            return Object.keys(municipalities)
                .filter(m => m.toLowerCase().includes(lowerInput))
                .slice(0, 10);
        }

        document.getElementById('municipality').addEventListener('input', function(e) {
            const suggestions = getMunicipalitySuggestions(e.target.value);
            const suggestionsDiv = document.getElementById('municipalitySuggestions');
            
            if (suggestions.length > 0) {
                suggestionsDiv.innerHTML = suggestions.map(m => 
                    `<div style="padding: 10px 16px; border-bottom: 1px solid #f0f0f0; cursor: pointer;" onclick="selectMunicipality('${m}')">${m}</div>`
                ).join('');
                suggestionsDiv.style.display = 'block';
            } else {
                suggestionsDiv.style.display = 'none';
            }
        });

        // Event listeners for percentage buttons
        document.querySelectorAll('.percentage-btn').forEach(btn => {
            btn.addEventListener('click', function(e) {
                e.preventDefault();
                // Remove active class from all buttons
                document.querySelectorAll('.percentage-btn').forEach(b => b.classList.remove('active'));
                // Add active class to clicked button
                this.classList.add('active');
                // Store value in hidden input
                document.getElementById('percentageValue').value = this.getAttribute('data-value');
            });
        });

        function selectMunicipality(name) {
            document.getElementById('municipality').value = name;
            document.getElementById('childCount').value = municipalities[name];
            document.getElementById('municipalitySuggestions').style.display = 'none';
        }

        function calculateResults() {
            const municipality = document.getElementById('municipality').value;
            const childCount = parseInt(document.getElementById('childCount').value) || 0;
            const activityType = document.querySelector('input[name="activity"]:checked').value;
            const effectivenessPercentage = parseInt(document.getElementById('percentageValue').value) / 100;

            if (!municipality || childCount === 0) {
                alert('Vennligst fyll inn kommune og antall barn');
                return;
            }

            if (!municipalities[municipality]) {
                alert('Kommune ikke funnet');
                return;
            }

            // Get activity label
            const activityLabels = {
                'delvis-fysisk': 'delvis aktiv til fysisk aktiv',
                'fysisk-ekstra': 'fysisk aktiv til ekstra aktiv'
            };
            const activityLabel = activityLabels[activityType];

            // Calculate values with effectiveness percentage
            const childrenAchievingChange = childCount * effectivenessPercentage;
            const healthSavingsPerChild = HEALTH_SAVINGS_PER_CHILD[activityType];
            const totalHealthSavings = childrenAchievingChange * healthSavingsPerChild;
            const totalParkdressenCost = childCount * PARKDRESSEN_COST_PER_CHILD; // 100% deltar
            const totalSavings = totalHealthSavings - totalParkdressenCost;

            // Calculate annual reduction in millions
            const annualReductionMillions = totalHealthSavings / 1000000;

            // Update info box
            const infoText = `Hvis ${Math.round(childrenAchievingChange)} personer i aldersgruppen fra 1 år, går fra ${activityLabel} i et livsløpsperspektiv, kan det gi:`;
            document.getElementById('infoText').textContent = infoText;

            // Update results
            document.getElementById('healthSavings').textContent = formatCurrency(totalHealthSavings);
            document.getElementById('parkdressenCost').textContent = '- ' + formatCurrency(totalParkdressenCost);
            document.getElementById('annualReduction').textContent = annualReductionMillions.toFixed(1) + ' mill. kr';
            document.getElementById('totalSavings').textContent = formatCurrency(totalSavings);
            document.getElementById('municipalityName').textContent = municipality;
            document.getElementById('totalDescription').textContent = 
                `Årlig netto besparelse når ${Math.round(childrenAchievingChange)} barnehagebarn oppnår aktivitetsendring`;

            document.getElementById('resultsSection').classList.add('active');
        }

        function resetForm() {
            document.getElementById('municipality').value = '';
            document.getElementById('childCount').value = '';
            document.querySelectorAll('.percentage-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector('[data-value="30"]').classList.add('active');
            document.getElementById('percentageValue').value = '30';
            document.getElementById('activity1').checked = true;
            document.getElementById('resultsSection').classList.remove('active');
            document.getElementById('municipalitySuggestions').style.display = 'none';
        }

        // Allow Enter key to calculate
        document.getElementById('childCount').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') calculateResults();
        });
    </script>
</body>
</html>